<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile | EFV™</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/dashboard-v2.css">
    <link rel="stylesheet" href="css/admin-modal.css">
    <link rel="stylesheet" href="css/reader.css">
    <link rel="stylesheet" href="css/security.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- PDF.js for Library Access -->
    <script src="js/pdfjs/pdf.min.js"></script>
    <script src="js/efv-pdf-data.js"></script>
</head>

<body class="dashboard-body">

    <div class="dashboard-container">
        <!-- LEFT SIDEBAR -->
        <aside class="sidebar glass-panel">
            <div class="sidebar-header">
                <a href="index.html" class="logo">
                    <img src="img/AISA.svg" alt="EFV Logo">
                    <span>EFV<sup>TM</sup></span>
                </a>
                <button class="dashboard-hamburger" id="dashboard-hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>

            <!-- User Profile Summary -->
            <div class="user-profile-sm">
                <div class="avatar-container">
                    <img src="img/default-avatar.png" alt="User Avatar" id="sidebar-avatar"
                        onerror="this.src='https://ui-avatars.com/api/?name=User&background=D4AF37&color=fff'">
                    <div class="status-indicator online"></div>
                </div>
                <div class="user-info">
                    <h4 id="sidebar-user-name">Guest User</h4>
                    <span class="membership-badge" id="sidebar-membership">Standard</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <a href="marketplace.html" class="nav-item" id="nav-back-to-shop">
                    <i class="fas fa-shopping-bag"></i> <span>Browse Store</span>
                </a>
                <button class="nav-item active" data-tab="dashboard">
                    <i class="fas fa-th-large"></i> <span>Dashboard</span>
                </button>
                <button class="nav-item" data-tab="cart">
                    <i class="fas fa-shopping-cart"></i> <span>Cart Items</span>
                    <span id="sidebar-cart-count" class="badge hidden">0</span>
                </button>
                <button class="nav-item" data-tab="orders">
                    <i class="fas fa-box-open"></i> <span>My Orders</span>
                </button>
                <button class="nav-item" data-tab="library">
                    <i class="fas fa-book-reader"></i> <span>My Library</span>
                </button>
                <button class="nav-item" data-tab="notifications">
                    <i class="fas fa-bell"></i> <span>Notifications</span>
                    <span id="unread-notifications-count" class="badge red hidden">0</span>
                </button>
                <button class="nav-item" data-tab="settings">
                    <i class="fas fa-cog"></i> <span>Account Settings</span>
                </button>
                <button class="nav-item" data-tab="support">
                    <i class="fas fa-headset"></i> <span>Help & Support</span>
                </button>

                <!-- Admin Items -->
                <button class="nav-item hidden" data-tab="admin" id="sidebar-admin-btn">
                    <i class="fas fa-user-shield"></i> <span>Admin Portal</span>
                </button>
                <button class="nav-item admin-nav hidden" data-tab="admin-orders">
                    <i class="fas fa-shopping-basket"></i> <span>Orders Management</span>
                </button>
                <button class="nav-item admin-nav hidden" data-tab="admin-products">
                    <i class="fas fa-book-medical"></i> <span>Product Management</span>
                </button>
                <button class="nav-item admin-nav hidden" data-tab="admin-customers">
                    <i class="fas fa-users-cog"></i> <span>Customers</span>
                </button>
                <button class="nav-item admin-nav hidden" data-tab="admin-payments">
                    <i class="fas fa-file-invoice-dollar"></i> <span>Payments</span>
                </button>
                <button class="nav-item admin-nav hidden" data-tab="admin-shipments">
                    <i class="fas fa-shipping-fast"></i> <span>Shipments</span>
                </button>
                <button class="nav-item admin-nav hidden" data-tab="admin-coupons">
                    <i class="fas fa-ticket-alt"></i> <span>Coupons</span>
                </button>
                <button class="nav-item admin-nav hidden" data-tab="admin-support">
                    <i class="fas fa-headset"></i> <span>User Support</span>
                </button>


                <div style="margin-top: auto; padding-top: 20px;">
                    <button class="nav-item" id="sidebar-logout-btn-v2"
                        style="color: #ff4d4d; width: 100%; text-align: left;" onclick="logoutAction()">
                        <i class="fas fa-sign-out-alt"></i> <span>Sign Out</span>
                    </button>
                </div>
            </nav>
        </aside>

        <!-- RIGHT CONTENT AREA -->
        <main class="main-content">

            <!-- DASHBOARD OVERVIEW TAB -->
            <section id="dashboard" class="content-section active">
                <header class="content-header">
                    <div class="welcome-text">
                        <h1 class="gradient-text">Welcome back, <span class="gold-text"
                                id="user-name-display">User</span></h1>
                        <p>Your alignment journey continues here</p>
                    </div>
                    <div class="date-display" id="current-date"></div>
                </header>

                <div class="stats-grid">
                    <div class="stat-card glass-panel shine-hover">
                        <div class="icon-box gold"><i class="fas fa-book"></i></div>
                        <div class="stat-info">
                            <h3>My Collection</h3>
                            <span id="stat-total-digital" class="stat-value">0</span>
                        </div>
                    </div>
                    <div class="stat-card glass-panel shine-hover">
                        <div class="icon-box blue"><i class="fas fa-shopping-bag"></i></div>
                        <div class="stat-info">
                            <h3>Total Orders</h3>
                            <span id="stat-total-orders" class="stat-value">0</span>
                        </div>
                    </div>
                    <div class="stat-card glass-panel shine-hover">
                        <div class="icon-box green"><i class="fas fa-coins"></i></div>
                        <div class="stat-info">
                            <h3>Total Spent</h3>
                            <span id="stat-total-spent" class="stat-value">₹0</span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid-2">
                    <div class="main-stats-col">
                        <div class="glass-panel" style="padding: 25px; margin-bottom: 25px;">
                            <h3 style="margin: 0 0 20px;"><i class="fas fa-history gold-text"></i> Recent Activity</h3>
                            <div class="mini-list" id="recent-orders-mini-list">
                                <p class="fade-text">No recent activity found.</p>
                            </div>
                        </div>

                        <div class="glass-panel" style="padding: 25px;">
                            <h3 style="margin: 0 0 20px;"><i class="fas fa-book-reader gold-text"></i> Continue Reading
                            </h3>
                            <div id="continue-reading-content-v2">
                                <p class="fade-text">Start your reading journey by browsing the store.</p>
                            </div>
                        </div>
                    </div>

                    <div class="side-stats-col">
                        <div class="glass-panel" style="padding: 25px;">
                            <h3 style="margin: 0 0 20px;"><i class="fas fa-star gold-text"></i> Recommended</h3>
                            <div id="recommended-products-list">
                                <p class="fade-text">Check out our latest releases in the store.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- CART ITEMS TAB -->
            <section id="cart" class="content-section">
                <!-- Cart structure from admin-dashboard for consistency -->
                <header class="content-header">
                    <div>
                        <h1>Shopping <span class="gold-text">Cart</span></h1>
                        <p id="cart-item-count-text">0 items in your cart</p>
                    </div>
                </header>
                <div class="cart-layout-grid" style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
                    <div class="cart-items-panel">
                        <div id="dashboard-cart-list" class="items-list"></div>
                        <div id="cart-empty-state" class="empty-state hidden">
                            <i class="fas fa-shopping-cart"></i>
                            <h3>Your cart is empty</h3>
                            <a href="marketplace.html" class="btn btn-gold">Browse Marketplace</a>
                        </div>
                    </div>
                    <div class="cart-summary-panel">
                        <div class="glass-panel checkout-summary-panel">
                            <h3>Order Summary</h3>
                            <div class="summary-details">
                                <div class="summary-row"><span>Subtotal</span><span id="cart-subtotal">₹0.00</span>
                                </div>
                                <div class="summary-row"><span>Tax (GST)</span><span id="cart-tax">₹0.00</span></div>
                                <div class="summary-row total"><span>Grand Total</span><span
                                        id="cart-grand-total">₹0.00</span></div>
                            </div>
                            <button class="btn btn-gold full-width" id="proceed-to-checkout-btn">Proceed to
                                Checkout</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- MY ORDERS TAB -->
            <section id="orders" class="content-section">
                <header class="content-header">
                    <h1>My <span class="gold-text">Orders</span></h1>
                    <p>Track your orders and download invoices</p>
                </header>
                <div id="dashboard-orders-list" class="orders-list"></div>
                <div id="orders-empty-state" class="empty-state hidden">
                    <i class="fas fa-box-open"></i>
                    <h3>No orders found</h3>
                </div>
            </section>

            <!-- MY LIBRARY TAB -->
            <section id="library" class="content-section">
                <header class="content-header"
                    style="justify-content: space-between; align-items: center; display: flex;">
                    <div>
                        <h1>My <span class="gold-text">Library</span></h1>
                        <p>Your digital collection</p>
                    </div>
                    <button class="btn btn-outline small" onclick="syncLibraryWithBackend()"><i
                            class="fas fa-sync-alt"></i> Sync</button>
                </header>
                <div id="dashboard-library-list" class="items-grid"></div>
                <div id="library-empty-state" class="empty-state hidden">
                    <i class="fas fa-book-open"></i>
                    <h3>Library is empty</h3>
                </div>
            </section>

            <!-- NOTIFICATIONS TAB -->
            <section id="notifications" class="content-section">
                <header class="content-header">
                    <h1>Account <span class="gold-text">Notifications</span></h1>
                </header>
                <div id="notifications-list" class="notifications-list"></div>
                <div id="notifications-empty-state" class="empty-state hidden">
                    <i class="fas fa-bell-slash"></i>
                    <h3>No new notifications</h3>
                </div>
            </section>

            <!-- SETTINGS TAB -->
            <section id="settings" class="content-section">
                <header class="content-header">
                    <h1>Account <span class="gold-text">Center</span></h1>
                    <p>Manage your profile and security</p>
                </header>
                <div class="settings-tabs" style="margin-bottom: 30px;">
                    <button class="settings-tab-btn active" data-settings-tab="profile-tab">Profile</button>
                    <button class="settings-tab-btn" data-settings-tab="security-tab">Security</button>
                    <button class="settings-tab-btn" data-settings-tab="addresses-tab">Addresses</button>
                </div>
                <div class="settings-content-area">
                    <div id="profile-tab" class="settings-pane active">
                        <div class="settings-card glass-panel">
                            <form id="profile-form-v2"
                                style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div class="form-group"><label>Full Name</label><input type="text" id="settings-name-v2"
                                        class="glass-input"></div>
                                <div class="form-group"><label>Email Address</label><input type="email"
                                        id="settings-email-v2" readonly class="glass-input" style="opacity: 0.7;"></div>
                                <div class="form-group"><label>Phone Number</label><input type="tel"
                                        id="settings-phone-v2" class="glass-input"></div>
                                <button type="submit" class="btn btn-gold"
                                    style="grid-column: span 2; width: 200px;">Save Changes</button>
                            </form>
                        </div>
                    </div>
                    <div id="security-tab" class="settings-pane" style="display: none;">
                        <div class="settings-card glass-panel">
                            <h3>Security</h3>
                            <button class="btn btn-danger" onclick="logoutAction()">Sign Out</button>
                        </div>
                    </div>
                    <div id="addresses-tab" class="settings-pane" style="display: none;">
                        <div class="settings-card glass-panel">
                            <div
                                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                                <h3>Addresses</h3>
                                <button class="btn btn-gold small" onclick="openAddressModal()">+ Add New</button>
                            </div>
                            <div id="saved-addresses-grid-v2"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- HELP & SUPPORT TAB -->
            <section id="support" class="content-section">
                <header class="content-header">
                    <h1>Help & <span class="gold-text">Support</span></h1>
                </header>
                <div class="settings-grid">
                    <div class="settings-card glass-panel">
                        <h3>Send a Message</h3>
                        <form id="user-support-form" style="display: flex; flex-direction: column; gap: 15px;">
                            <input type="text" id="support-subject" placeholder="Subject" required class="glass-input">
                            <textarea id="support-message" placeholder="Message" required class="glass-input"
                                rows="5"></textarea>
                            <button type="submit" class="btn btn-gold full-width" id="send-support-btn">Send
                                Message</button>
                        </form>
                    </div>
                    <div class="settings-card glass-panel">
                        <h3>Direct Support</h3>
                        <button class="btn btn-outline full-width"
                            onclick="location.href='mailto:support@efv.com'">Email Us</button>
                    </div>
                </div>

                <div class="glass-panel" style="margin-top: 30px; padding: 25px;">
                    <h3 style="margin-bottom: 20px;"><i class="fas fa-history gold-text"></i> My Inquiries</h3>
                    <div id="user-support-history">
                        <p class="fade-text">No previous inquiries found.</p>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Modals -->
    <div id="order-detail-modal" class="resume-modal-overlay" style="display: none;">
        <div class="resume-modal glass-panel" style="max-width: 800px; width: 95%;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0; color: var(--gold-text);">Order <span id="modal-order-id">#ORD-000</span></h2>
                <button onclick="closeOrderDetailModal()"
                    style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>
            <div id="modal-order-items"></div>
        </div>
    </div>

    <div id="address-modal" class="resume-modal-overlay" style="display: none;">
        <div class="resume-modal glass-panel" style="max-width: 550px; width: 95%;">
            <h2 id="address-modal-title" style="margin-bottom: 20px; color: var(--gold-text);">Add Address</h2>
            <form id="address-form" style="display: flex; flex-direction: column; gap: 15px;">
                <input type="text" id="addr-name" placeholder="Name" required class="glass-input">
                <input type="tel" id="addr-phone" placeholder="Phone" required class="glass-input">
                <input type="text" id="addr-pincode" placeholder="Pincode" required class="glass-input">
                <input type="text" id="addr-city" placeholder="City" required class="glass-input">
                <input type="text" id="addr-state" placeholder="State" required class="glass-input">
                <textarea id="addr-full" placeholder="Full Address" required class="glass-input" rows="3"></textarea>
                <button type="submit" class="btn btn-gold full-width">Save Address</button>
                <button type="button" onclick="closeAddressModal()" class="btn btn-outline full-width">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="js/api-config.js"></script>
    <script src="js/profile.js"></script>
    <script src="js/security.js"></script>
</body>

</html>